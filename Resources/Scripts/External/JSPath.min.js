(function(){var d={PATH:1,SELECTOR:2,OBJ_PRED:3,POS_PRED:4,LOGICAL_EXPR:5,COMPARISON_EXPR:6,MATH_EXPR:7,CONCAT_EXPR:8,UNARY_EXPR:9,POS_EXPR:10,LITERAL:11};var e=(function(){var z={ID:1,NUM:2,STR:3,BOOL:4,PUNCT:5,EOP:6},x={UNEXP_TOKEN:'Unexpected token "%0"',UNEXP_EOP:"Unexpected end of path"};var Q,T,y,s;function t(ad){Q=ad.split("");T=0;y=null;s=Q.length;var ac=G(),ab=q();if(ab.type!==z.EOP){F(ab)}return ac}function G(){var ac=X(),ab;while(l("|")){q();(ab||(ab=[ac])).push(X())}return ab?{type:d.CONCAT_EXPR,args:ab}:ac}function X(){return l("(")?D():W()}function D(){j("(");var ad=G();j(")");var ac=[],ab;while(ab=S()){ac.push(ab)}if(!ac.length){return ad}else{if(ad.type===d.PATH){ad.parts=ad.parts.concat(ac);return ad}}ac.unshift(ad);return{type:d.PATH,parts:ac}}function S(){if(l("[")){return aa()}if(l("{")){return H()}if(l("(")){return D()}}function W(){if(!I()){F(q())}var ab=false,ad;if(l("^")){q();ab=true}else{if(m()){ad=q().val.substr(1)}}var ae=[],ac;while(ac=E()){ae.push(ac)}return{type:d.PATH,fromRoot:ab,subst:ad,parts:ae}}function E(){return R()?k():S()}function k(){var ab=q().val,ac=U(),ad;if(l("*")||ac.type===z.ID||ac.type===z.STR){ad=q().val}return{type:d.SELECTOR,selector:ab,prop:ad}}function aa(){j("[");var ab=V();j("]");return{type:d.POS_PRED,arg:ab}}function H(){j("{");var ab=Y();j("}");return{type:d.OBJ_PRED,arg:ab}}function Y(){var ac=L(),ab;while(l("||")){q();(ab||(ab=[ac])).push(L())}return ab?{type:d.LOGICAL_EXPR,op:"||",args:ab}:ac}function L(){var ac=o(),ab;while(l("&&")){q();(ab||(ab=[ac])).push(o())}return ab?{type:d.LOGICAL_EXPR,op:"&&",args:ab}:ac}function o(){var ab=w();while(l("==")||l("!=")||l("===")||l("!==")||l("^=")||l("^==")||l("$==")||l("$=")||l("*==")||l("*=")){ab={type:d.COMPARISON_EXPR,op:q().val,args:[ab,o()]}}return ab}function w(){var ab=u();while(l("<")||l(">")||l("<=")||l(">=")){ab={type:d.COMPARISON_EXPR,op:q().val,args:[ab,w()]}}return ab}function u(){var ab=v();while(l("+")||l("-")){ab={type:d.MATH_EXPR,op:q().val,args:[ab,u()]}}return ab}function v(){var ab=P();while(l("*")||l("/")||l("%")){ab={type:d.MATH_EXPR,op:q().val,args:[ab,v()]}}return ab}function V(){if(l(":")){q();return{type:d.POS_EXPR,toIdx:P()}}var ab=P();if(l(":")){q();if(l("]")){return{type:d.POS_EXPR,fromIdx:ab}}return{type:d.POS_EXPR,fromIdx:ab,toIdx:P()}}return{type:d.POS_EXPR,idx:ab}}function P(){if(l("!")||l("-")){return{type:d.UNARY_EXPR,op:q().val,arg:P()}}return J()}function J(){var ab=U(),ac=ab.type;if(ac===z.STR||ac===z.NUM||ac===z.BOOL){return{type:d.LITERAL,val:q().val}}if(I()){return W()}if(l("(")){return n()}return F(q())}function n(){j("(");var ab=Y();j(")");return ab}function l(ac){var ab=U();return ab.type===z.PUNCT&&ab.val===ac}function I(){return R()||m()||l("^")}function R(){var ab=U();if(ab.type===z.PUNCT){var ac=ab.val;return ac==="."||ac===".."}return false}function m(){var ab=U();return ab.type===z.ID&&ab.val[0]==="$"}function j(ac){var ab=q();if(ab.type!==z.PUNCT||ab.val!==ac){F(ab)}}function U(){if(y!==null){return y}var ab=T;y=p();T=ab;return y}function p(){while(C(Q[T])){++T}if(T>=s){return{type:z.EOP,range:[T,T]}}var ab=N();if(ab||(ab=B())||(ab=K())||(ab=A())){return ab}ab={range:[T,T]};T>=s?ab.type=z.EOP:ab.val=Q[T];F(ab)}function q(){var ab;if(y){T=y.range[1];ab=y;y=null;return ab}return p()}function M(ab){return"0123456789".indexOf(ab)>=0}function C(ab){return ab===" "}function O(ab){return(ab==="$")||(ab==="_")||(ab>="a"&&ab<="z")||(ab>="A"&&ab<="Z")}function Z(ab){return O(ab)||(ab>="0"&&ab<="9")}function B(){var ab=Q[T];if(!O(ab)){return}var ad=T,ac=ab;while(++T<s){ab=Q[T];if(!Z(ab)){break}ac+=ab}return ac==="true"||ac==="false"?{type:z.BOOL,val:ac==="true",range:[ad,T]}:{type:z.ID,val:ac,range:[ad,T]}}function K(){if(Q[T]!=='"'){return}var ae=++T,ad="",ab=false,ac;while(T<s){ac=Q[T++];if(ac==="\\"){ac=Q[T++]}else{if(ac==='"'){ab=true;break}}ad+=ac}if(ab){return{type:z.STR,val:ad,range:[ae,T]}}}function A(){var ae=T,ad=Q[T],ab=ad===".";if(ab||M(ad)){var ac=ad;while(++T<s){ad=Q[T];if(ad==="."){if(ab){return}ab=true}else{if(!M(ad)){break}}ac+=ad}return{type:z.NUM,val:ab?parseFloat(ac):parseInt(ac,10),range:[ae,T]}}}function N(){var ae=T,ad=Q[T],ac=Q[T+1];if(ad==="."){if(M(ac)){return}return Q[++T]==="."?{type:z.PUNCT,val:"..",range:[ae,++T]}:{type:z.PUNCT,val:".",range:[ae,T]}}if(ac==="="){var ab=Q[T+2];if(ab==="="){if("=!^$*".indexOf(ad)>=0){return{type:z.PUNCT,val:ad+ac+ab,range:[ae,T+=3]}}}else{if("=!^$*><".indexOf(ad)>=0){return{type:z.PUNCT,val:ad+ac,range:[ae,T+=2]}}}}if(ad===ac&&(ad==="|"||ad==="&")){return{type:z.PUNCT,val:ad+ac,range:[ae,T+=2]}}if(":{}()[]^+-*/%!><|".indexOf(ad)>=0){return{type:z.PUNCT,val:ad,range:[ae,++T]}}}function F(ab){if(ab.type===z.EOP){r(ab,x.UNEXP_EOP)}r(ab,x.UNEXP_TOKEN,ab.val)}function r(ad,af){var ac=Array.prototype.slice.call(arguments,2),ae=af.replace(/%(\d)/g,function(ah,ag){return ac[ag]||""}),ab=new Error(ae);ab.column=ad.range[0];throw ab}return t})();var c=(function(){var o,v,r,x;function t(){if(x.length){return x.shift()}var I="v"+ ++r;v.push(I);return I}function q(){var I=arguments,J=I.length;while(J--){x.push(I[J])}}function p(I){o=[];v=["res"];r=0;x=[];A(I,"res","data");o.unshift("var ",Array.isArray?"isArr = Array.isArray":'toStr = Object.prototype.toString, isArr = function(o) { return toStr.call(o) === "[object Array]"; }',",",v.join(","),";");if(I.type===d.PATH){var J=I.parts[I.parts.length-1];if(J&&J.type===d.POS_PRED&&"idx" in J.arg){o.push("res = res[0];")}}o.push("return res;");return o.join("")}function k(O,K,J){var N=O.parts,L=0,I=N.length;o.push(K,"=",O.fromRoot?"data":O.subst?"subst."+O.subst:J,";","isArr("+K+") || ("+K+" = ["+K+"]);");while(L<I){var M=N[L++];switch(M.type){case d.SELECTOR:M.selector===".."?H(M,K,K):m(M,K,K);break;case d.OBJ_PRED:w(M,K,K);break;case d.POS_PRED:y(M,K,K);break;case d.CONCAT_EXPR:n(M,K,K);break}}}function m(I,R,S){if(I.prop){var O=j(I.prop),Q=t(),M=t(),P=t(),N=t(),L=t(),J=t(),K=t();o.push(Q,"= [];",M,"= 0;",P,"=",S,".length;",K,"= [];","while(",M,"<",P,") {",N,"=",S,"[",M,"++];","if(",N,"!= null) {");if(I.prop==="*"){o.push("if(typeof ",N,'=== "object") {',"if(isArr(",N,")) {",Q,"=",Q,".concat(",N,");","}","else {","for(",L," in ",N,") {","if(",N,".hasOwnProperty(",L,")) {",J,"=",N,"[",L,"];");C(Q,J);o.push("}","}","}","}")}else{o.push(J,"=",N,"[",O,"];");C(Q,J,K,P)}o.push("}","}",R,"=",P,"> 1 &&",K,".length?",K,".length > 1?",Q,".concat.apply(",Q,",",K,") :",Q,".concat(",K,"[0]) :",Q,";");q(Q,M,P,N,L,J,K)}}function H(J,S,P){var I=J.prop,T=t(),O=t(),M=t(),N=t(),L=t(),K=t(),Q=t(),R=t();o.push(T,"=",P,".slice(),",R,"= [];","while(",T,".length) {",O,"=",T,".shift();");I?o.push("if(typeof ",O,'=== "object" &&',O,") {"):o.push("if(typeof ",O,"!= null) {");o.push(M,"= [];","if(isArr(",O,")) {",N,"= 0,",Q,"=",O,".length;","while(",N,"<",Q,") {",K,"=",O,"[",N,"++];");I&&o.push("if(typeof ",K,'=== "object") {');C(M,K);I&&o.push("}");o.push("}","}","else {");if(I){if(I!=="*"){o.push(K,"=",O,'["'+I+'"];');C(R,K)}}else{C(R,O);o.push("if(typeof ",O,'=== "object") {')}o.push("for(",L," in ",O,") {","if(",O,".hasOwnProperty(",L,")) {",K,"=",O,"[",L,"];");C(M,K);I==="*"&&C(R,K);o.push("}","}");I||o.push("}");o.push("}",M,".length &&",T,".unshift.apply(",T,",",M,");","}","}",S,"=",R,";");q(T,O,M,N,L,K,Q,R)}function w(P,K,J){var O=t(),L=t(),I=t(),N=t(),M=t();o.push(O,"= [];",L,"= 0;",I,"=",J,".length;","while(",L,"<",I,") {",M,"=",J,"[",L,"++];");A(P.arg,N,M);o.push(F(P.arg,N),"&&",O,".push(",M,");","}",K,"=",O,";");q(O,L,I,M,N)}function y(N,L,J){var K=N.arg,M,O;if(K.idx){var I=t();A(K.idx,I,J);o.push(I,"< 0 && (",I,"=",J,".length +",I,");",L,"=",J,"[",I,"] == null? [] : [",J,"[",I,"]];");q(I);return false}else{if(K.fromIdx){if(K.toIdx){A(K.fromIdx,M=t(),J);A(K.toIdx,O=t(),J);o.push(L,"=",J,".slice(",M,",",O,");");q(M,O)}else{A(K.fromIdx,M=t(),J);o.push(L,"=",J,".slice(",M,");");q(M)}}else{A(K.toIdx,O=t(),J);o.push(L,"=",J,".slice(0,",O,");");q(O)}}}function A(K,J,I){switch(K.type){case d.PATH:k(K,J,I);break;case d.CONCAT_EXPR:n(K,J,I);break;case d.COMPARISON_EXPR:G(K,J,I);break;case d.MATH_EXPR:u(K,J,I);break;case d.LOGICAL_EXPR:s(K,J,I);break;case d.UNARY_EXPR:D(K,J,I);break;case d.LITERAL:var L=K.val;o.push(J,"=",typeof L==="string"?j(L):L,";");break}}function G(T,U,W){var P=t(),N=t(),O=t(),V=t(),L=t(),K=t(),J=t(),I=t(),M=T.args[0],S=T.args[1];o.push(U,"= false;");A(M,P,W);A(S,N,W);var R=M.type===d.PATH,Q=S.type===d.LITERAL;o.push(O,"=");R?o.push("true;"):o.push("isArr(",P,");");o.push(V,"=");Q?o.push("false;"):o.push("isArr(",N,");");o.push("if(");R||o.push(O,"&&");o.push(P,".length === 1) {",P,"=",P,"[0];",O,"= false;","}");Q||o.push("if(",V,"&&",N,".length === 1) {",N,"=",N,"[0];",V,"= false;","}");o.push(L,"= 0;","if(",O,") {",J,"=",P,".length;");if(!Q){o.push("if(",V,") {",I,"=",N,".length;","while(",L,"<",J,"&& !",U,") {",K,"= 0;","while(",K,"<",I,") {");E(T.op,[P,"[",L,"]"].join(""),[N,"[",K,"]"].join(""));o.push(U,"= true;","break;","}","++",K,";","}","++",L,";","}","}","else {")}o.push("while(",L,"<",J,") {");E(T.op,[P,"[",L,"]"].join(""),N);o.push(U,"= true;","break;","}","++",L,";","}");Q||o.push("}");o.push("}");if(!Q){o.push("else if(",V,") {",I,"=",N,".length;","while(",L,"<",I,") {");E(T.op,P,[N,"[",L,"]"].join(""));o.push(U,"= true;","break;","}","++",L,";","}","}")}o.push("else {",U,"=",z[T.op](P,N),";","}");q(P,N,O,V,L,K,J,I)}function E(K,J,I){o.push("if(",z[K](J,I),") {")}function s(N,L,J){var P=[],K=N.args,I=K.length,M=0,O;o.push(L,"= false;");switch(N.op){case"&&":while(M<I){P.push(O=t());A(K[M],O,J);o.push("if(",F(K[M++],O),") {")}o.push(L,"= true;");break;case"||":while(M<I){P.push(O=t());A(K[M],O,J);o.push("if(",F(K[M],O),") {",L,"= true;","}");if(M+++1<I){o.push("else {")}}--I;break}while(I--){o.push("}")}q.apply(null,P)}function u(N,K,I){var M=t(),L=t(),J=N.args;A(J[0],M,I);A(J[1],L,I);o.push(K,"=",z[N.op](l(J[0],M),l(J[1],L)),";");q(M,L)}function D(L,K,J){var M=t(),I=L.arg;A(I,M,J);switch(L.op){case"!":o.push(K,"= !",F(I,M)+";");break;case"-":o.push(K,"= -",l(I,M)+";");break}q(M)}function n(O,L,J){var N=[],K=O.args,I=K.length,M=0;while(M<I){N.push(t());A(K[M],N[M++],J)}o.push(L,"= (",L,"= []).concat.call(",L,",",N.join(","),");");q.apply(null,N)}function j(I){return"'"+I.replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'"}function C(K,L,J,I){o.push("if(",L,"!= null) {","if(isArr(",L,")) {");if(J){o.push(I,"> 1?");B(J,L);o.push(":")}o.push(K,"=",K,".length? ",K,".concat(",L,") : ",L,";","}","else {");J&&o.push("if(",J,".length) {",K,"=",K,".concat.apply(",K,",",J,");",J,"= [];","}");B(K,L);o.push(";","}","}")}function B(I,J){o.push(I,".length?",I,".push(",J,") :",I,"[0] =",J)}function F(I,J){switch(I.type){case d.LOGICAL_EXPR:return J;case d.LITERAL:return"!!"+J;case d.PATH:return J+".length > 0";default:return["(typeof ",J,'=== "boolean"?',J,":","isArr(",J,")?",J,".length > 0 : !!",J,")"].join("")}}function l(I,J){switch(I.type){case d.LITERAL:return J;case d.PATH:return J+"[0]";default:return["(isArr(",J,")?",J,"[0] : ",J,")"].join("")}}var z={"===":function(J,I){return J+"==="+I},"==":function(J,I){return["typeof ",J,'=== "string" && typeof ',I,'=== "string"?',J,".toLowerCase() ===",I,".toLowerCase() :"+J,"==",I].join("")},">=":function(J,I){return J+">="+I},">":function(J,I){return J+">"+I},"<=":function(J,I){return J+"<="+I},"<":function(J,I){return J+"<"+I},"!==":function(J,I){return J+"!=="+I},"!=":function(J,I){return J+"!="+I},"^==":function(J,I){return["typeof ",J,'=== "string" && typeof ',I,'=== "string" &&',J,".indexOf(",I,") === 0"].join("")},"^=":function(J,I){return[J,"!= null &&",I,"!= null &&",J,".toString().toLowerCase().indexOf(",I,".toString().toLowerCase()) === 0"].join("")},"$==":function(J,I){return["typeof ",J,'=== "string" && typeof ',I,'=== "string" &&',J,".lastIndexOf(",I,") ===",J,".length -",I,".length"].join("")},"$=":function(J,I){return[J,"!= null &&",I,"!= null &&","(",J,"=",J,".toLowerCase().toString()).indexOf(","(",I,"=",I,".toLowerCase().toLowerCase())) ===",J,".length -",I,".length"].join("")},"*==":function(J,I){return["typeof ",J,'=== "string" && typeof ',I,'=== "string" &&',J,".indexOf(",I,") > -1"].join("")},"*=":function(J,I){return[J,"!= null && ",I,"!= null &&",J,".toString().toLowerCase().indexOf(",I,".toString().toLowerCase()) > -1"].join("")},"+":function(J,I){return J+"+"+I},"-":function(J,I){return J+"-"+I},"*":function(J,I){return J+"*"+I},"/":function(J,I){return J+"/"+I},"%":function(J,I){return J+"%"+I}};return p})();function i(j){return Function("data,subst",c(e(j)))}var a={},g=[],f={cacheSize:100},b={cacheSize:function(j,k){if(k<j&&g.length>k){var m=g.splice(0,g.length-k),l=m.length;while(l--){delete a[m[l]]}}}};var h=function(l,j,k){if(!a[l]){a[l]=i(l);if(g.push(l)>f.cacheSize){delete a[g.shift()]}}return a[l](j,k||{})};h.version="0.3.0";h.params=function(j){if(!arguments.length){return f}for(var k in j){if(j.hasOwnProperty(k)){b[k]&&b[k](f[k],j[k]);f[k]=j[k]}}};h.compile=i;h.apply=h;if(typeof module==="object"&&typeof module.exports==="object"){module.exports=h}else{if(typeof modules==="object"){modules.define("jspath",function(j){j(h)})}else{if(typeof define==="function"){define(function(k,j,l){l.exports=h})}else{JSPath=h}}}})();